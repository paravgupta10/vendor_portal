<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Vendor Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/static/css/vendor_dashboard.css" />
  
</head>
<body>

  <a href="/logout" class="logout">Logout</a>
  <button class="sidebar-toggle" onclick="toggleSidebar()">☰</button>

  <div class="sidebar">
    <div class="sidebar-content">
      <h3>Vendor Panel</h3>
      <div class="logo">
        <img src="/static/images/login2.jpeg" alt="Vendor Logo" />
      </div>
      <a href="#" onclick="showSection('details')">Vendor Details</a>
      <a href="#" onclick="showSection('upload')">Upload Invoice</a>
      <a href="#" onclick="showSection('review')">Review Invoices</a>
    </div>
  </div>

  <div class="main-content">
    <div class="section-box show" id="welcomeSection">
      <h2>Welcome, {{ company }}!</h2>
      <div class="info">
        <p><strong>Email:</strong> {{ session.get('email', 'Not shown here') }}</p>
        <p><strong>Registration Status:</strong> {{ vendor.status|capitalize }}</p>
      </div>
    </div>

    <div id="detailsSection" class="section-box">
      <h3>Your Registration Details</h3>
      <div class="details-grid">
        <p><strong>Company Name:</strong> {{ vendor.company_name }}</p>
        <p><strong>Type of Business:</strong> <span style="text-transform: uppercase;">{{ vendor.ownership_type }}</span></p>
        <p><strong>Address:</strong> {{ vendor.registered_address }}</p>
        <p><strong>TAN Number:</strong> {{ vendor.tan_number }}</p>
        <p><strong>City:</strong> {{ vendor.city }}</p>
        <p><strong>GST Number:</strong> {{ vendor.gst_number }}</p>
        <p><strong>State:</strong> {{ vendor.state }}</p>
        <p><strong>Phone:</strong> {{ vendor.phone }}</p>
        <p><strong>Country:</strong> {{ vendor.country }}</p>
      </div>
      <a id="back-link-wrapper" href="{{ url_for('vendor_dashboard') }}">⬅ Back to Dashboard</a>
    </div>

    {% if vendor.status == 'approved' %}
    <div id="uploadSection" class="section-box">
      <h3>Upload Invoice</h3><br>
      <p>Please upload your invoice in JPEG format.</p><br>
      <form action="{{ url_for('upload_invoice') }}" method="POST" enctype="multipart/form-data">
        <input type="file" name="invoice" accept=".jpeg, .jpg" required style="padding: 10px; border: 1px solid #ccc; border-radius: 6px;">
        <br><br>
        <button type="submit" class="tab-button">Submit Invoice</button>
      </form>
      <a id="back-link-wrapper" href="{{ url_for('vendor_dashboard') }}">⬅ Back to Dashboard</a>
    </div>

    <div id="reviewSection" class="section-box">
      <h3>Your Uploaded Invoices</h3>
      {% if invoices %}
      <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>File Name</th>
            <th>Upload Date</th>
            <th>Status</th>
            <th>View</th>
          </tr>
        </thead>
        <tbody>
          {% for inv in invoices %}
          <tr>
            <td>{{ inv.file_name }}</td>
            <td>{{ inv.uploaded_at.strftime('%d-%m-%Y') }}</td>
            <td><a href="{{ inv.file_url }}" target="_blank">View</a></td>
            <td>{{ inv.status|capitalize }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      </div>
      {% else %}
      <p>No invoices uploaded yet.</p>
      {% endif %}
      <a id="back-link-wrapper" href="{{ url_for('vendor_dashboard') }}">⬅ Back to Dashboard</a>
    </div>
    {% else %}
    <div class="section-box" style="background: #fff3f3; color: #b94a48; text-align: center;">
      <h3>Invoice Upload Unavailable</h3>
      <p>You can upload invoices only after your registration has been <strong>approved</strong>.</p>
    </div>
    {% endif %}

    <div class="footer-contact">
      <p>For any queries please contact Admin (admin1@example.com)</p>
    </div>
    
  </div>

  <div id="toast" class="toast">Invoice uploaded successfully.</div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
        document.body.classList.add('loaded');
    });

    function toggleSidebar() {
      const sidebar = document.querySelector('.sidebar');
      sidebar.classList.toggle('active');

      const mainContent = document.querySelector('.main-content');
      if (sidebar.classList.contains('active')) {
        mainContent.addEventListener('click', collapseSidebarOnce);
      } else {
        mainContent.removeEventListener('click', collapseSidebarOnce);
      }
    }

    function collapseSidebarOnce() {
      const sidebar = document.querySelector('.sidebar');
      sidebar.classList.remove('active');

      const mainContent = document.querySelector('.main-content');
      mainContent.removeEventListener('click', collapseSidebarOnce);
    }

    function showSection(section) {
        const sections = document.querySelectorAll('.section-box');
        sections.forEach(s => {
            if (s.id !== 'welcomeSection') {
                s.classList.remove('show');
            }
        });
        
        const selected = document.getElementById(section + 'Section');
        if (selected) {
            selected.classList.add('show');
        }

        if (window.innerWidth <= 768) {
            document.querySelector('.sidebar').classList.remove('active');
        }
    }

    function showToast(message) {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.classList.add('show');
        setTimeout(() => {
            toast.classList.remove('show');
        }, 3000);
    }
</script>

  {% with messages = get_flashed_messages() %}
    {% for message in messages %}
      {% if "Invoice uploaded successfully" in message %}
        <script>
          window.addEventListener('DOMContentLoaded', () => {
            showToast("{{ message }}");
          });
        </script>
      {% endif %}
    {% endfor %}
  {% endwith %}
</body>
</html>